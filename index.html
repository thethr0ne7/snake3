<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ó–º–µ–π–∫–∞: –ö–æ—Ñ–µ –∏ –Ø–¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    :root {
      --bg-primary: #020617;
      --bg-secondary: #0f172a;
      --text-primary: #e5e7eb;
      --text-secondary: #9ca3af;
      --accent-green: #22c55e;
      --accent-orange: #f97316;
      --grid-color: #1e293b;
      --border-color: #334155;
      --snake-head: #22c55e;
      --snake-body: #16a34a;
    }

    /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è */
    * {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      overflow: hidden;
      overscroll-behavior: none;
      position: fixed;
      width: 100%;
      height: 100%;
      touch-action: none;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text-primary);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      padding: 16px;
      overflow: hidden;
    }

    .game-container {
      background: rgba(2, 6, 23, 0.95);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-color);
      width: 100%;
      max-width: 440px;
      max-height: 90vh;
      backdrop-filter: blur(10px);
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .game-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .title-text {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-green), #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 0.5px;
    }

    .score-container {
      background: var(--bg-secondary);
      padding: 8px 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .score-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 2px;
    }

    .score-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-green);
    }

    .game-canvas-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      border: 2px solid var(--border-color);
      background: var(--bg-primary);
      margin-bottom: 20px;
      touch-action: none;
    }

    #game {
      display: block;
      width: 100%;
      height: auto;
      image-rendering: crisp-edges;
      image-rendering: pixelated;
      touch-action: none;
    }

    .controls-info {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 20px;
    }

    .control-group {
      flex: 1;
    }

    .control-title {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .control-description {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .game-legend {
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .legend-item:last-child {
      margin-bottom: 0;
    }

    .legend-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .legend-text {
      font-size: 13px;
      color: var(--text-primary);
    }

    .legend-highlight {
      color: var(--accent-orange);
      font-weight: 600;
    }

    .game-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(2, 6, 23, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      border-radius: 16px;
      z-index: 10;
    }

    .game-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .overlay-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #ef4444, #f97316);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .overlay-score {
      font-size: 24px;
      color: var(--text-primary);
      margin-bottom: 24px;
    }

    .overlay-button {
      background: linear-gradient(135deg, var(--accent-green), #3b82f6);
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      touch-action: manipulation;
    }

    .overlay-button:active {
      transform: scale(0.98);
    }

    .touch-hint {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--text-secondary);
      font-size: 12px;
      background: rgba(0, 0, 0, 0.5);
      padding: 4px 12px;
      border-radius: 20px;
      opacity: 0.7;
      z-index: 5;
    }

    @media (max-width: 768px) {
      body {
        padding: 12px;
        overflow: hidden;
        position: fixed;
      }
      
      .game-container {
        padding: 20px;
        max-height: 95vh;
      }
      
      .controls-info {
        flex-direction: column;
        gap: 12px;
      }
      
      .title-text {
        font-size: 16px;
      }
      
      .score-value {
        font-size: 20px;
      }
      
      .game-canvas-wrapper {
        touch-action: none;
      }
      
      #game {
        touch-action: none;
      }
    }

    @media (hover: none) {
      .overlay-button:hover {
        transform: none;
        box-shadow: none;
      }
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-height: 600px) {
      .game-container {
        padding: 16px;
      }
      
      .game-header {
        margin-bottom: 12px;
      }
      
      .game-canvas-wrapper {
        margin-bottom: 12px;
      }
      
      .controls-info {
        margin-bottom: 12px;
      }
      
      .game-legend {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="game-header">
      <div class="game-title">
        <div class="title-text">–ö–û–§–ï–ô–ù–ê–Ø –ó–ú–ï–ô–ö–ê</div>
      </div>
      <div class="score-container">
        <div class="score-label">–°–ß–Å–¢</div>
        <div class="score-value" id="score">0</div>
      </div>
    </div>

    <div class="game-canvas-wrapper">
      <canvas id="game" width="400" height="400"></canvas>
      <div class="touch-hint" id="touchHint">–°–≤–∞–π–ø—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
      
      <div class="game-overlay" id="gameOverlay">
        <div class="overlay-title" id="overlayTitle">–ü–ê–£–ó–ê</div>
        <div class="overlay-score">–°—á—ë—Ç: <span id="overlayScore">0</span></div>
        <button class="overlay-button" id="resumeButton">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
      </div>
    </div>

    <div class="controls-info">
      <div class="control-group">
        <div class="control-title">–ü–ö –£–ü–†–ê–í–õ–ï–ù–ò–ï</div>
        <div class="control-description">
          –°—Ç—Ä–µ–ª–∫–∏ ‚Üê‚Üë‚Üì‚Üí ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ<br>
          P –∏–ª–∏ –ø—Ä–æ–±–µ–ª ‚Äî –ø–∞—É–∑–∞<br>
          R ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
        </div>
      </div>
      <div class="control-group">
        <div class="control-title">–ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï</div>
        <div class="control-description">
          –°–≤–∞–π–ø—ã –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —ç–∫—Ä–∞–Ω–∞<br>
          –î–≤–æ–π–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ ‚Äî –ø–∞—É–∑–∞<br>
          –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
        </div>
      </div>
    </div>

    <div class="game-legend">
      <div class="legend-item">
        <div class="legend-icon">‚òï</div>
        <div class="legend-text">
          <span class="legend-highlight">–ö–æ—Ñ–µ</span> ‚Äî —Å—ä–µ—Å—Ç—å (+1 –∫ –¥–ª–∏–Ω–µ, +1 –æ—á–∫–æ)
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-icon">üõë</div>
        <div class="legend-text">
          <span class="legend-highlight">–Ø–¥</span> ‚Äî –∫–æ—Å–Ω—É—Ç—å—Å—è (-2 –¥–ª–∏–Ω—ã, -1 –æ—á–∫–æ)
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-icon">üåÄ</div>
        <div class="legend-text">
          <span class="legend-highlight">–ü–æ—Ä—Ç–∞–ª—ã</span> ‚Äî –≤—ã—Ö–æ–¥ —Å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        </div>
      </div>
    </div>
  </div>

  <script>
    'use strict';

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–∏—Ñ–∏–ª –¥–ª—è roundRect –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
      };
    }

    class SnakeGame {
      constructor() {
        console.log('SnakeGame constructor called');
        this.canvas = document.getElementById('game');
        this.ctx = this.canvas.getContext('2d');
        this.scoreElement = document.getElementById('score');
        this.overlay = document.getElementById('gameOverlay');
        this.overlayTitle = document.getElementById('overlayTitle');
        this.overlayScore = document.getElementById('overlayScore');
        this.resumeButton = document.getElementById('resumeButton');
        this.touchHint = document.getElementById('touchHint');
        
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã - –£–í–ï–õ–ò–ß–ò–õ–ò –°–ö–û–†–û–°–¢–¨ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ = –±–æ–ª—å—à–µ —á–∏—Å–ª–æ)
        this.GRID_SIZE = 20;
        this.TILE_COUNT = this.canvas.width / this.GRID_SIZE;
        this.INITIAL_SPEED = 180; // –ë—ã–ª–æ 150, —Å—Ç–∞–ª–æ 180 (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
        this.POISON_SHRINK = 2;
        this.MIN_LENGTH = 2;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        this.lastDirectionChange = 0;
        this.directionChangeDelay = 100; // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–º–µ–Ω–∞–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–º—Å)
        this.lastTouchTime = 0;
        this.doubleTapDelay = 300;
        this.touchStartX = 0;
        this.touchStartY = 0;
        this.minSwipeDistance = 40; // –£–≤–µ–ª–∏—á–∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–≤–∞–π–ø–∞
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        this.snake = [];
        this.velocity = { x: 1, y: 0 };
        this.nextVelocity = { x: 1, y: 0 };
        this.food = { x: 0, y: 0 };
        this.poison = { x: 0, y: 0 };
        this.score = 0;
        this.isPaused = false;
        this.isGameOver = false;
        this.gameInterval = null;
        this.speed = this.INITIAL_SPEED;
        
        this.init();
      }

      init() {
        console.log('Game init');
        this.resetGame();
        this.setupControls();
        this.render();
        this.startGameLoop();
        
        // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        setTimeout(() => {
          this.touchHint.style.opacity = '0';
          this.touchHint.style.transition = 'opacity 0.5s';
          setTimeout(() => {
            this.touchHint.style.display = 'none';
          }, 500);
        }, 5000);
      }

      resetGame() {
        console.log('Reset game');
        if (this.gameInterval) {
          clearInterval(this.gameInterval);
          this.gameInterval = null;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–º–µ–π–∫—É
        this.snake = [
          { x: 10, y: 10 },
          { x: 9, y: 10 },
          { x: 8, y: 10 }
        ];
        
        this.velocity = { x: 1, y: 0 };
        this.nextVelocity = { x: 1, y: 0 };
        this.score = 0;
        this.speed = this.INITIAL_SPEED;
        this.isGameOver = false;
        this.isPaused = false;
        
        this.updateScore();
        this.generateFood();
        this.generatePoison();
        this.hideOverlay();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        this.touchHint.style.display = 'block';
        this.touchHint.style.opacity = '0.7';
        this.touchHint.style.transition = 'none';
      }

      generateFood() {
        this.food = this.getRandomPosition([...this.snake, this.poison]);
      }

      generatePoison() {
        this.poison = this.getRandomPosition([...this.snake, this.food]);
      }

      getRandomPosition(exclude = []) {
        let position;
        let isInvalid;
        
        do {
          position = {
            x: Math.floor(Math.random() * this.TILE_COUNT),
            y: Math.floor(Math.random() * this.TILE_COUNT)
          };
          
          isInvalid = exclude.some(pos => 
            pos && pos.x === position.x && pos.y === position.y
          );
        } while (isInvalid);
        
        return position;
      }

      updateScore() {
        this.scoreElement.textContent = this.score;
        this.overlayScore.textContent = this.score;
      }

      move() {
        if (this.isPaused || this.isGameOver) return;

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        const now = Date.now();
        if (now - this.lastDirectionChange > this.directionChangeDelay) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ –ø—ã—Ç–∞–µ–º—Å—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ 180 –≥—Ä–∞–¥—É—Å–æ–≤
          if (!(this.velocity.x === -this.nextVelocity.x && this.velocity.y === -this.nextVelocity.y)) {
            this.velocity = { ...this.nextVelocity };
          }
          this.lastDirectionChange = now;
        }

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –≥–æ–ª–æ–≤—É
        const head = { ...this.snake[0] };
        head.x += this.velocity.x;
        head.y += this.velocity.y;

        // –ü–æ—Ä—Ç–∞–ª—ã —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã
        if (head.x < 0) head.x = this.TILE_COUNT - 1;
        if (head.x >= this.TILE_COUNT) head.x = 0;
        if (head.y < 0) head.y = this.TILE_COUNT - 1;
        if (head.y >= this.TILE_COUNT) head.y = 0;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Å–æ–±–æ–π
        if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
          this.gameOver();
          return;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≥–æ–ª–æ–≤—É
        this.snake.unshift(head);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—ä–µ–ª–∏ –ª–∏ –µ–¥—É
        if (head.x === this.food.x && head.y === this.food.y) {
          this.score++;
          this.updateScore();
          this.generateFood();
          
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
          if (this.score % 5 === 0 && this.speed > 80) {
            this.speed -= 10;
            this.restartGameLoop();
          }
        }
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—ä–µ–ª–∏ –ª–∏ —è–¥
        else if (head.x === this.poison.x && head.y === this.poison.y) {
          this.score = Math.max(0, this.score - 1);
          this.updateScore();
          
          // –£–∫–æ—Ä–∞—á–∏–≤–∞–µ–º –∑–º–µ–π–∫—É
          for (let i = 0; i < this.POISON_SHRINK; i++) {
            if (this.snake.length > this.MIN_LENGTH) {
              this.snake.pop();
            }
          }
          
          this.generatePoison();
        }
        // –û–±—ã—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
        else {
          this.snake.pop();
        }
      }

      render() {
        // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
        this.ctx.fillStyle = '#020617';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É (—Å–≤–µ—Ç–ª–µ–µ)
        this.ctx.strokeStyle = '#2d3748';
        this.ctx.lineWidth = 1;
        
        for (let i = 0; i <= this.TILE_COUNT; i++) {
          // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
          this.ctx.beginPath();
          this.ctx.moveTo(i * this.GRID_SIZE, 0);
          this.ctx.lineTo(i * this.GRID_SIZE, this.canvas.height);
          this.ctx.stroke();
          
          // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
          this.ctx.beginPath();
          this.ctx.moveTo(0, i * this.GRID_SIZE);
          this.ctx.lineTo(this.canvas.width, i * this.GRID_SIZE);
          this.ctx.stroke();
        }

        // –†–∏—Å—É–µ–º –µ–¥—É (–∫–æ—Ñ–µ)
        this.ctx.font = `${this.GRID_SIZE * 0.8}px sans-serif`;
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';
        this.ctx.fillStyle = '#f97316';
        this.ctx.fillText('‚òï', 
          this.food.x * this.GRID_SIZE + this.GRID_SIZE / 2,
          this.food.y * this.GRID_SIZE + this.GRID_SIZE / 2
        );

        // –†–∏—Å—É–µ–º —è–¥ (—Å—Ç–æ–ø-–∑–Ω–∞–∫)
        this.ctx.fillStyle = '#ef4444';
        this.ctx.fillText('üõë',
          this.poison.x * this.GRID_SIZE + this.GRID_SIZE / 2,
          this.poison.y * this.GRID_SIZE + this.GRID_SIZE / 2
        );

        // –†–∏—Å—É–µ–º –∑–º–µ–π–∫—É —Å –ø–ª–∞–≤–Ω—ã–º–∏ –∫—Ä–∞—è–º–∏
        this.snake.forEach((segment, index) => {
          const padding = 3;
          const size = this.GRID_SIZE - padding * 2;
          
          if (index === 0) {
            // –ì–æ–ª–æ–≤–∞
            this.ctx.fillStyle = '#22c55e';
            this.ctx.beginPath();
            this.ctx.roundRect(
              segment.x * this.GRID_SIZE + padding,
              segment.y * this.GRID_SIZE + padding,
              size,
              size,
              6
            );
            this.ctx.fill();
            
            // –ì–ª–∞–∑–∞
            this.ctx.fillStyle = '#ffffff';
            const eyeSize = this.GRID_SIZE / 8;
            const eyeOffset = this.GRID_SIZE / 3;
            
            // –õ–µ–≤—ã–π –≥–ª–∞–∑
            this.ctx.beginPath();
            this.ctx.arc(
              segment.x * this.GRID_SIZE + eyeOffset,
              segment.y * this.GRID_SIZE + eyeOffset,
              eyeSize,
              0,
              Math.PI * 2
            );
            this.ctx.fill();
            
            // –ü—Ä–∞–≤—ã–π –≥–ª–∞–∑
            this.ctx.beginPath();
            this.ctx.arc(
              segment.x * this.GRID_SIZE + this.GRID_SIZE - eyeOffset,
              segment.y * this.GRID_SIZE + eyeOffset,
              eyeSize,
              0,
              Math.PI * 2
            );
            this.ctx.fill();
          } else {
            // –¢–µ–ª–æ
            const colorIndex = index % 3;
            const colors = ['#16a34a', '#15803d', '#166534'];
            this.ctx.fillStyle = colors[colorIndex];
            
            this.ctx.beginPath();
            this.ctx.roundRect(
              segment.x * this.GRID_SIZE + padding,
              segment.y * this.GRID_SIZE + padding,
              size,
              size,
              4
            );
            this.ctx.fill();
          }
        });
      }

      startGameLoop() {
        if (this.gameInterval) {
          clearInterval(this.gameInterval);
        }
        
        this.gameInterval = setInterval(() => {
          this.move();
          this.render();
        }, this.speed);
      }

      restartGameLoop() {
        if (this.gameInterval) {
          clearInterval(this.gameInterval);
        }
        this.startGameLoop();
      }

      gameOver() {
        this.isGameOver = true;
        if (this.gameInterval) {
          clearInterval(this.gameInterval);
          this.gameInterval = null;
        }
        this.showOverlay('–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', 'restart');
      }

      togglePause() {
        if (this.isGameOver) {
          this.restartGame();
          return;
        }
        
        this.isPaused = !this.isPaused;
        
        if (this.isPaused) {
          if (this.gameInterval) {
            clearInterval(this.gameInterval);
            this.gameInterval = null;
          }
          this.showOverlay('–ü–ê–£–ó–ê', 'resume');
        } else {
          this.hideOverlay();
          this.startGameLoop();
        }
      }

      showOverlay(title, action = 'resume') {
        this.overlayTitle.textContent = title;
        this.overlayScore.textContent = this.score;
        
        this.resumeButton.textContent = action === 'restart' ? '–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê' : '–ü–†–û–î–û–õ–ñ–ò–¢–¨';
        
        this.resumeButton.onclick = action === 'restart' 
          ? () => this.restartGame() 
          : () => this.togglePause();
        
        this.overlay.classList.add('active');
      }

      hideOverlay() {
        this.overlay.classList.remove('active');
      }

      restartGame() {
        this.resetGame();
        this.startGameLoop();
      }

      setupControls() {
        // –ü–ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        document.addEventListener('keydown', (e) => {
          if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' ', 'p', 'r'].includes(e.key.toLowerCase())) {
            e.preventDefault();
          }
          
          const now = Date.now();
          if (now - this.lastDirectionChange < this.directionChangeDelay) return;
          
          switch (e.key.toLowerCase()) {
            case 'arrowup':
            case 'w':
              if (this.velocity.y === 0) this.nextVelocity = { x: 0, y: -1 };
              break;
            case 'arrowdown':
            case 's':
              if (this.velocity.y === 0) this.nextVelocity = { x: 0, y: 1 };
              break;
            case 'arrowleft':
            case 'a':
              if (this.velocity.x === 0) this.nextVelocity = { x: -1, y: 0 };
              break;
            case 'arrowright':
            case 'd':
              if (this.velocity.x === 0) this.nextVelocity = { x: 1, y: 0 };
              break;
            case ' ':
            case 'p':
              this.togglePause();
              break;
            case 'r':
              this.restartGame();
              break;
          }
        });

        // –ú–æ–±–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - —É–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–≤–∞–π–ø—ã
        let touchStart = null;
        let isSwiping = false;

        const handleTouchStart = (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          touchStart = {
            x: touch.clientX,
            y: touch.clientY,
            time: Date.now()
          };
          isSwiping = false;
        };

        const handleTouchMove = (e) => {
          if (!touchStart) return;
          e.preventDefault();
          
          const touch = e.touches[0];
          const dx = touch.clientX - touchStart.x;
          const dy = touch.clientY - touchStart.y;
          
          // –ï—Å–ª–∏ —Å–≤–∞–π–ø –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π, –æ—Ç–º–µ—á–∞–µ–º –∫–∞–∫ —Å–≤–∞–π–ø
          if (Math.abs(dx) > 10 || Math.abs(dy) > 10) {
            isSwiping = true;
          }
        };

        const handleTouchEnd = (e) => {
          if (!touchStart) return;
          e.preventDefault();
          
          const touch = e.changedTouches[0];
          const dx = touch.clientX - touchStart.x;
          const dy = touch.clientY - touchStart.y;
          const dt = Date.now() - touchStart.time;
          
          // –î–≤–æ–π–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ –¥–ª—è –ø–∞—É–∑—ã
          const now = Date.now();
          if (now - this.lastTouchTime < this.doubleTapDelay && !isSwiping) {
            this.togglePause();
            this.lastTouchTime = 0;
            touchStart = null;
            return;
          }
          
          this.lastTouchTime = now;
          
          // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª —Å–≤–∞–π–ø (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–ª–µ–∫–æ)
          if (dt < 300 && (Math.abs(dx) > this.minSwipeDistance || Math.abs(dy) > this.minSwipeDistance)) {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            if (Math.abs(dx) > Math.abs(dy)) {
              // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
              if (dx > 0 && this.velocity.x === 0) {
                this.nextVelocity = { x: 1, y: 0 };
              } else if (dx < 0 && this.velocity.x === 0) {
                this.nextVelocity = { x: -1, y: 0 };
              }
            } else {
              // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
              if (dy > 0 && this.velocity.y === 0) {
                this.nextVelocity = { x: 0, y: 1 };
              } else if (dy < 0 && this.velocity.y === 0) {
                this.nextVelocity = { x: 0, y: -1 };
              }
            }
          }
          
          touchStart = null;
          isSwiping = false;
        };

        // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ –≤—Å–µ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –∏–≥—Ä—ã
        const gameContainer = document.querySelector('.game-container');
        gameContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
        gameContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
        gameContainer.addEventListener('touchend', handleTouchEnd, { passive: false });
        gameContainer.addEventListener('touchcancel', () => {
          touchStart = null;
          isSwiping = false;
        }, { passive: false });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        gameContainer.addEventListener('contextmenu', (e) => {
          e.preventDefault();
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∂–µ—Å—Ç–æ–º –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
        document.addEventListener('gesturestart', (e) => {
          e.preventDefault();
        });
        
        document.addEventListener('gesturechange', (e) => {
          e.preventDefault();
        });
        
        document.addEventListener('gestureend', (e) => {
          e.preventDefault();
        });
      }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
      try {
        console.log('Starting game...');
        window.game = new SnakeGame();
        console.log('Game started successfully');
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∫—Ä–æ–ª–ª–∞
        window.addEventListener('scroll', (e) => {
          window.scrollTo(0, 0);
        });
        
        // –ó–∞—â–∏—Ç–∞ –æ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('touchmove', (e) => {
          if (e.scale !== 1) {
            e.preventDefault();
          }
        }, { passive: false });
        
      } catch (error) {
        console.error('Error starting game:', error);
      }
    });
  </script>
</body>
</html>
