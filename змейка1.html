<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ó–º–µ–π–∫–∞: –ö–æ—Ñ–µ –∏ –Ø–¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0f172a;
      font-family: 'Segoe UI', system-ui, sans-serif;
      padding: 20px;
    }

    .game-container {
      background: #1e293b;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid #334155;
      max-width: 440px;
      width: 100%;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #22c55e, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .score {
      background: #334155;
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 20px;
      font-weight: 600;
      color: #22c55e;
    }

    .game-area {
      position: relative;
      margin-bottom: 20px;
    }

    canvas {
      display: block;
      width: 100%;
      height: 400px;
      background: #020617;
      border-radius: 12px;
      border: 2px solid #334155;
      image-rendering: pixelated;
    }

    .controls {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .control-group {
      flex: 1;
      background: #334155;
      padding: 12px;
      border-radius: 10px;
    }

    .control-title {
      font-size: 12px;
      color: #94a3b8;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .control-desc {
      font-size: 13px;
      color: #e2e8f0;
      line-height: 1.4;
    }

    .legend {
      background: #334155;
      padding: 16px;
      border-radius: 10px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .legend-icon {
      font-size: 20px;
      width: 30px;
      text-align: center;
    }

    .legend-text {
      font-size: 14px;
      color: #e2e8f0;
    }

    .legend-highlight {
      color: #f97316;
      font-weight: 600;
    }

    .game-over {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(2, 6, 23, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .game-over.active {
      opacity: 1;
      pointer-events: all;
    }

    .game-over-title {
      font-size: 32px;
      color: #ef4444;
      margin-bottom: 16px;
      font-weight: 700;
    }

    .game-over-score {
      font-size: 24px;
      color: #e2e8f0;
      margin-bottom: 20px;
    }

    .restart-btn {
      background: linear-gradient(135deg, #22c55e, #3b82f6);
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .restart-btn:active {
      transform: scale(0.95);
    }

    @media (max-width: 480px) {
      .controls {
        flex-direction: column;
        gap: 12px;
      }
      
      canvas {
        height: 350px;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="header">
      <div class="title">–ö–û–§–ï–ô–ù–ê–Ø –ó–ú–ï–ô–ö–ê</div>
      <div class="score">–°–ß–Å–¢: <span id="score">0</span></div>
    </div>
    
    <div class="game-area">
      <canvas id="game" width="400" height="400"></canvas>
      
      <div class="game-over" id="gameOver">
        <div class="game-over-title">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</div>
        <div class="game-over-score">–°—á—ë—Ç: <span id="finalScore">0</span></div>
        <button class="restart-btn" onclick="resetGame()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
      </div>
    </div>
    
    <div class="controls">
      <div class="control-group">
        <div class="control-title">–ü–ö –£–ü–†–ê–í–õ–ï–ù–ò–ï</div>
        <div class="control-desc">
          –°—Ç—Ä–µ–ª–∫–∏ ‚Üê‚Üë‚Üì‚Üí ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ<br>
          –ü—Ä–æ–±–µ–ª ‚Äî –ø–∞—É–∑–∞/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
        </div>
      </div>
      <div class="control-group">
        <div class="control-title">–ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï</div>
        <div class="control-desc">
          –°–≤–∞–π–ø—ã –ø–æ —ç–∫—Ä–∞–Ω—É<br>
          –ö–∞—Å–∞–Ω–∏–µ ‚Äî –ø–∞—É–∑–∞
        </div>
      </div>
    </div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-icon">‚òï</div>
        <div class="legend-text">
          <span class="legend-highlight">–ö–æ—Ñ–µ</span> ‚Äî —Å—ä–µ—Å—Ç—å (+1 –∫ –¥–ª–∏–Ω–µ, +1 –æ—á–∫–æ)
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-icon">üõë</div>
        <div class="legend-text">
          <span class="legend-highlight">–Ø–¥</span> ‚Äî –∫–æ—Å–Ω—É—Ç—å—Å—è (-2 –¥–ª–∏–Ω—ã, -1 –æ—á–∫–æ)
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-icon">üåÄ</div>
        <div class="legend-text">
          <span class="legend-highlight">–ü–æ—Ä—Ç–∞–ª—ã</span> ‚Äî –≤—ã—Ö–æ–¥ —Å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========== –ù–ê–°–¢–†–û–ô–ö–ò –ò–ì–†–´ ==========
    const GRID_SIZE = 20;
    const TILE_COUNT = 20;
    const INITIAL_SPEED = 150; // –º—Å
    const POISON_SHRINK = 2;
    const MIN_LENGTH = 2;

    // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ==========
    let canvas, ctx;
    let snake = [];
    let velocity = { x: 1, y: 0 };
    let food = { x: 0, y: 0 };
    let poison = { x: 0, y: 0 };
    let score = 0;
    let gameRunning = true;
    let gamePaused = false;
    let lastUpdate = 0;
    let gameLoopId = null;
    let speed = INITIAL_SPEED;

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    function init() {
      canvas = document.getElementById('game');
      ctx = canvas.getContext('2d');
      
      resetGame();
      setupEventListeners();
      gameLoop();
    }

    // ========== –°–ë–†–û–° –ò–ì–†–´ ==========
    function resetGame() {
      // –°–æ–∑–¥–∞–µ–º –∑–º–µ–π–∫—É
      snake = [
        { x: 10, y: 10 },
        { x: 9, y: 10 },
        { x: 8, y: 10 }
      ];
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
      velocity = { x: 1, y: 0 };
      score = 0;
      speed = INITIAL_SPEED;
      gameRunning = true;
      gamePaused = false;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
      updateScore();
      
      // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
      document.getElementById('gameOver').classList.remove('active');
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –µ–¥—É –∏ —è–¥
      generateFood();
      generatePoison();
      
      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
      draw();
    }

    // ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –ï–î–´ ==========
    function generateFood() {
      let position;
      let isValid;
      
      do {
        position = {
          x: Math.floor(Math.random() * TILE_COUNT),
          y: Math.floor(Math.random() * TILE_COUNT)
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –∑–º–µ–π–∫–µ –∏–ª–∏ –Ω–∞ —è–¥–µ
        isValid = !snake.some(segment => segment.x === position.x && segment.y === position.y) &&
                  !(position.x === poison.x && position.y === poison.y);
      } while (!isValid);
      
      food = position;
    }

    // ========== –ì–ï–ù–ï–†–ê–¶–ò–Ø –Ø–î–ê ==========
    function generatePoison() {
      let position;
      let isValid;
      
      do {
        position = {
          x: Math.floor(Math.random() * TILE_COUNT),
          y: Math.floor(Math.random() * TILE_COUNT)
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–∞ –∑–º–µ–π–∫–µ –∏–ª–∏ –Ω–∞ –µ–¥–µ
        isValid = !snake.some(segment => segment.x === position.x && segment.y === position.y) &&
                  !(position.x === food.x && position.y === food.y);
      } while (!isValid);
      
      poison = position;
    }

    // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ß–ï–¢–ê ==========
    function updateScore() {
      document.getElementById('score').textContent = score;
      document.getElementById('finalScore').textContent = score;
    }

    // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ì–†–´ ==========
    function update(currentTime) {
      if (!gameRunning || gamePaused) return;
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
      if (currentTime - lastUpdate < speed) return;
      lastUpdate = currentTime;
      
      // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –≥–æ–ª–æ–≤—ã
      const head = { ...snake[0] };
      head.x += velocity.x;
      head.y += velocity.y;
      
      // –ü–æ—Ä—Ç–∞–ª —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã
      if (head.x < 0) head.x = TILE_COUNT - 1;
      if (head.x >= TILE_COUNT) head.x = 0;
      if (head.y < 0) head.y = TILE_COUNT - 1;
      if (head.y >= TILE_COUNT) head.y = 0;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
      if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
        gameOver();
        return;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≥–æ–ª–æ–≤—É
      snake.unshift(head);
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—ä–µ–ª–∏ –ª–∏ –µ–¥—É
      if (head.x === food.x && head.y === food.y) {
        score++;
        updateScore();
        generateFood();
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
        if (score % 5 === 0 && speed > 80) {
          speed -= 10;
        }
      }
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—ä–µ–ª–∏ –ª–∏ —è–¥
      else if (head.x === poison.x && head.y === poison.y) {
        score = Math.max(0, score - 1);
        updateScore();
        
        // –£–∫–æ—Ä–∞—á–∏–≤–∞–µ–º –∑–º–µ–π–∫—É
        for (let i = 0; i < POISON_SHRINK; i++) {
          if (snake.length > MIN_LENGTH) {
            snake.pop();
          }
        }
        
        generatePoison();
      }
      // –û–±—ã—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
      else {
        snake.pop();
      }
      
      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
      draw();
    }

    // ========== –û–¢–†–ò–°–û–í–ö–ê ==========
    function draw() {
      // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
      ctx.fillStyle = '#020617';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
      ctx.strokeStyle = '#1e293b';
      ctx.lineWidth = 1;
      
      for (let i = 0; i <= TILE_COUNT; i++) {
        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
        ctx.beginPath();
        ctx.moveTo(i * GRID_SIZE, 0);
        ctx.lineTo(i * GRID_SIZE, canvas.height);
        ctx.stroke();
        
        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
        ctx.beginPath();
        ctx.moveTo(0, i * GRID_SIZE);
        ctx.lineTo(canvas.width, i * GRID_SIZE);
        ctx.stroke();
      }
      
      // –†–∏—Å—É–µ–º –µ–¥—É (–∫–æ—Ñ–µ)
      ctx.font = `${GRID_SIZE * 0.8}px sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#f97316';
      ctx.fillText('‚òï', 
        food.x * GRID_SIZE + GRID_SIZE / 2,
        food.y * GRID_SIZE + GRID_SIZE / 2
      );
      
      // –†–∏—Å—É–µ–º —è–¥ (—Å—Ç–æ–ø-–∑–Ω–∞–∫)
      ctx.fillStyle = '#ef4444';
      ctx.fillText('üõë',
        poison.x * GRID_SIZE + GRID_SIZE / 2,
        poison.y * GRID_SIZE + GRID_SIZE / 2
      );
      
      // –†–∏—Å—É–µ–º –∑–º–µ–π–∫—É
      snake.forEach((segment, index) => {
        if (index === 0) {
          // –ì–æ–ª–æ–≤–∞
          ctx.fillStyle = '#22c55e';
        } else {
          // –¢–µ–ª–æ
          ctx.fillStyle = '#16a34a';
        }
        
        ctx.fillRect(
          segment.x * GRID_SIZE + 2,
          segment.y * GRID_SIZE + 2,
          GRID_SIZE - 4,
          GRID_SIZE - 4
        );
        
        // –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã –¥–ª—è –≥–æ–ª–æ–≤—ã
        if (index === 0) {
          ctx.beginPath();
          ctx.roundRect(
            segment.x * GRID_SIZE + 2,
            segment.y * GRID_SIZE + 2,
            GRID_SIZE - 4,
            GRID_SIZE - 4,
            4
          );
          ctx.fill();
          
          // –ì–ª–∞–∑–∞
          ctx.fillStyle = '#ffffff';
          const eyeSize = GRID_SIZE / 8;
          ctx.beginPath();
          ctx.arc(
            segment.x * GRID_SIZE + GRID_SIZE * 0.3,
            segment.y * GRID_SIZE + GRID_SIZE * 0.3,
            eyeSize,
            0,
            Math.PI * 2
          );
          ctx.arc(
            segment.x * GRID_SIZE + GRID_SIZE * 0.7,
            segment.y * GRID_SIZE + GRID_SIZE * 0.3,
            eyeSize,
            0,
            Math.PI * 2
          );
          ctx.fill();
        }
      });
    }

    // ========== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ==========
    function gameLoop(timestamp) {
      update(timestamp);
      gameLoopId = requestAnimationFrame(gameLoop);
    }

    // ========== –ö–û–ù–ï–¶ –ò–ì–†–´ ==========
    function gameOver() {
      gameRunning = false;
      document.getElementById('gameOver').classList.add('active');
    }

    // ========== –ü–ê–£–ó–ê ==========
    function togglePause() {
      if (!gameRunning) {
        resetGame();
        return;
      }
      
      gamePaused = !gamePaused;
      
      if (gamePaused) {
        document.getElementById('gameOver').classList.add('active');
        document.getElementById('gameOver').querySelector('.game-over-title').textContent = '–ü–ê–£–ó–ê';
        document.getElementById('gameOver').querySelector('.restart-btn').textContent = '–ü–†–û–î–û–õ–ñ–ò–¢–¨';
      } else {
        document.getElementById('gameOver').classList.remove('active');
      }
    }

    // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
    function setupEventListeners() {
      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
      document.addEventListener('keydown', (e) => {
        e.preventDefault();
        
        switch (e.key) {
          case 'ArrowUp':
          case 'w':
          case 'W':
            if (velocity.y === 0) velocity = { x: 0, y: -1 };
            break;
          case 'ArrowDown':
          case 's':
          case 'S':
            if (velocity.y === 0) velocity = { x: 0, y: 1 };
            break;
          case 'ArrowLeft':
          case 'a':
          case 'A':
            if (velocity.x === 0) velocity = { x: -1, y: 0 };
            break;
          case 'ArrowRight':
          case 'd':
          case 'D':
            if (velocity.x === 0) velocity = { x: 1, y: 0 };
            break;
          case ' ':
          case 'Spacebar':
            togglePause();
            break;
          case 'r':
          case 'R':
            resetGame();
            break;
        }
      });
      
      // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö (—Å–≤–∞–π–ø—ã)
      let touchStartX = 0;
      let touchStartY = 0;
      
      canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        touchStartX = touch.clientX;
        touchStartY = touch.clientY;
      }, { passive: false });
      
      canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        
        if (!gameRunning || gamePaused) return;
        
        const touch = e.changedTouches[0];
        const dx = touch.clientX - touchStartX;
        const dy = touch.clientY - touchStartY;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞
        if (Math.abs(dx) > Math.abs(dy)) {
          // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
          if (dx > 20 && velocity.x === 0) velocity = { x: 1, y: 0 };
          if (dx < -20 && velocity.x === 0) velocity = { x: -1, y: 0 };
        } else {
          // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
          if (dy > 20 && velocity.y === 0) velocity = { x: 0, y: 1 };
          if (dy < -20 && velocity.y === 0) velocity = { x: 0, y: -1 };
        }
        
        // –ö–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ = –ø–∞—É–∑–∞
        if (Math.abs(dx) < 10 && Math.abs(dy) < 10) {
          togglePause();
        }
      }, { passive: false });
      
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
      canvas.addEventListener('contextmenu', (e) => e.preventDefault());
    }

    // ========== –ó–ê–ü–£–°–ö –ò–ì–†–´ ==========
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É roundRect –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
      };
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', init);
  </script>
</body>
</html>
