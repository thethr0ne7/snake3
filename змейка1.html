<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ó–º–µ–π–∫–∞: –ö–æ—Ñ–µ –∏ –Ø–¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <style>
    :root {
      --bg-primary: #020617;
      --bg-secondary: #0f172a;
      --text-primary: #e5e7eb;
      --text-secondary: #9ca3af;
      --accent-green: #22c55e;
      --accent-orange: #f97316;
      --grid-color: #1e293b;
      --border-color: #334155;
      --snake-head: #22c55e;
      --snake-body: #16a34a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: var(--text-primary);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      padding: 16px;
      overflow: hidden;
    }

    .game-container {
      background: rgba(2, 6, 23, 0.95);
      border-radius: 24px;
      padding: 24px;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-color);
      width: 100%;
      max-width: 440px;
      backdrop-filter: blur(10px);
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .game-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .game-title img {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      object-fit: cover;
      border: 2px solid var(--border-color);
    }

    .title-text {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-green), #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 0.5px;
    }

    .score-container {
      background: var(--bg-secondary);
      padding: 8px 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .score-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 2px;
    }

    .score-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-green);
    }

    .game-canvas-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      border: 2px solid var(--border-color);
      background: var(--bg-primary);
      margin-bottom: 20px;
    }

    #game {
      display: block;
      width: 100%;
      height: auto;
      image-rendering: crisp-edges;
      image-rendering: pixelated;
    }

    .controls-info {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 20px;
    }

    .control-group {
      flex: 1;
    }

    .control-title {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-weight: 600;
    }

    .control-description {
      font-size: 13px;
      color: var(--text-primary);
      line-height: 1.4;
    }

    .game-legend {
      background: var(--bg-secondary);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .legend-item:last-child {
      margin-bottom: 0;
    }

    .legend-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .legend-text {
      font-size: 13px;
      color: var(--text-primary);
    }

    .legend-highlight {
      color: var(--accent-orange);
      font-weight: 600;
    }

    .game-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(2, 6, 23, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      border-radius: 16px;
    }

    .game-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .overlay-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #ef4444, #f97316);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .overlay-score {
      font-size: 24px;
      color: var(--text-primary);
      margin-bottom: 24px;
    }

    .overlay-button {
      background: linear-gradient(135deg, var(--accent-green), #3b82f6);
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .overlay-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.3);
    }

    .overlay-button:active {
      transform: translateY(0);
    }

    .mobile-controls {
      display: none;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 8px;
      margin-top: 20px;
      max-width: 200px;
    }

    .mobile-controls button {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      color: white;
      font-size: 20px;
      aspect-ratio: 1;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mobile-controls button:active {
      background: rgba(255, 255, 255, 0.2);
    }

    .mobile-controls .up { grid-column: 2; grid-row: 1; }
    .mobile-controls .left { grid-column: 1; grid-row: 2; }
    .mobile-controls .center { grid-column: 2; grid-row: 2; opacity: 0; pointer-events: none; }
    .mobile-controls .right { grid-column: 3; grid-row: 2; }
    .mobile-controls .down { grid-column: 2; grid-row: 3; }

    @media (max-width: 768px) {
      body {
        padding: 12px;
      }
      
      .game-container {
        padding: 20px;
      }
      
      .controls-info {
        flex-direction: column;
        gap: 12px;
      }
      
      .mobile-controls {
        display: grid;
      }
      
      .title-text {
        font-size: 16px;
      }
      
      .score-value {
        font-size: 20px;
      }
    }

    @media (hover: none) {
      .overlay-button:hover {
        transform: none;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="game-header">
      <div class="game-title">
        <div class="title-text">–ö–û–§–ï–ô–ù–ê–Ø –ó–ú–ï–ô–ö–ê</div>
      </div>
      <div class="score-container">
        <div class="score-label">–°–ß–Å–¢</div>
        <div class="score-value" id="score">0</div>
      </div>
    </div>

    <div class="game-canvas-wrapper">
      <canvas id="game" width="400" height="400"></canvas>
      
      <div class="game-overlay" id="gameOverlay">
        <div class="overlay-title" id="overlayTitle">–ü–ê–£–ó–ê</div>
        <div class="overlay-score">–°—á—ë—Ç: <span id="overlayScore">0</span></div>
        <button class="overlay-button" id="resumeButton">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
      </div>
    </div>

    <div class="controls-info">
      <div class="control-group">
        <div class="control-title">–ü–ö –£–ü–†–ê–í–õ–ï–ù–ò–ï</div>
        <div class="control-description">
          –°—Ç—Ä–µ–ª–∫–∏ ‚Üê‚Üë‚Üì‚Üí ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ<br>
          P –∏–ª–∏ –ø—Ä–æ–±–µ–ª ‚Äî –ø–∞—É–∑–∞<br>
          R ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
        </div>
      </div>
      <div class="control-group">
        <div class="control-title">–ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï</div>
        <div class="control-description">
          –°–≤–∞–π–ø—ã –ø–æ —ç–∫—Ä–∞–Ω—É<br>
          –ö–∞—Å–∞–Ω–∏–µ ‚Äî –ø–∞—É–∑–∞<br>
          –ö–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        </div>
      </div>
    </div>

    <div class="mobile-controls">
      <button class="up" aria-label="–í–≤–µ—Ä—Ö">‚Üë</button>
      <button class="left" aria-label="–í–ª–µ–≤–æ">‚Üê</button>
      <button class="center"></button>
      <button class="right" aria-label="–í–ø—Ä–∞–≤–æ">‚Üí</button>
      <button class="down" aria-label="–í–Ω–∏–∑">‚Üì</button>
    </div>

    <div class="game-legend">
      <div class="legend-item">
        <div class="legend-icon">‚òï</div>
        <div class="legend-text">
          <span class="legend-highlight">–ö–æ—Ñ–µ</span> ‚Äî —Å—ä–µ—Å—Ç—å (+1 –∫ –¥–ª–∏–Ω–µ, +1 –æ—á–∫–æ)
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-icon">üõë</div>
        <div class="legend-text">
          <span class="legend-highlight">–Ø–¥</span> ‚Äî –∫–æ—Å–Ω—É—Ç—å—Å—è (-2 –¥–ª–∏–Ω—ã, -1 –æ—á–∫–æ)
        </div>
      </div>
      <div class="legend-item">
        <div class="legend-icon">üåÄ</div>
        <div class="legend-text">
          <span class="legend-highlight">–ü–æ—Ä—Ç–∞–ª—ã</span> ‚Äî –≤—ã—Ö–æ–¥ —Å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        </div>
      </div>
    </div>
  </div>

  <script>
    class SnakeGame {
      constructor() {
        this.canvas = document.getElementById('game');
        this.ctx = this.canvas.getContext('2d');
        this.scoreElement = document.getElementById('score');
        this.overlay = document.getElementById('gameOverlay');
        this.overlayTitle = document.getElementById('overlayTitle');
        this.overlayScore = document.getElementById('overlayScore');
        
        this.gridSize = 20;
        this.tileCount = this.canvas.width / this.gridSize;
        
        this.snake = [];
        this.velocity = { x: 1, y: 0 };
        this.food = null;
        this.poison = null;
        this.score = 0;
        this.isPaused = false;
        this.isGameOver = false;
        this.animationId = null;
        this.lastTimestamp = 0;
        this.speed = 150; // ms –º–µ–∂–¥—É –¥–≤–∏–∂–µ–Ω–∏—è–º–∏
        
        this.init();
      }

      init() {
        this.resetGame();
        this.setupControls();
        this.setupMobileControls();
        this.render();
        this.startGameLoop();
      }

      resetGame() {
        this.snake = [
          { x: 10, y: 10 },
          { x: 9, y: 10 },
          { x: 8, y: 10 }
        ];
        this.velocity = { x: 1, y: 0 };
        this.score = 0;
        this.isGameOver = false;
        this.speed = 150;
        this.updateScore();
        
        this.generateFood();
        this.generatePoison();
        
        this.hideOverlay();
      }

      generateFood() {
        this.food = this.getRandomPosition([...this.snake, this.poison].filter(Boolean));
      }

      generatePoison() {
        this.poison = this.getRandomPosition([...this.snake, this.food].filter(Boolean));
      }

      getRandomPosition(exclude = []) {
        let position;
        let isInvalid;
        
        do {
          position = {
            x: Math.floor(Math.random() * this.tileCount),
            y: Math.floor(Math.random() * this.tileCount)
          };
          
          isInvalid = exclude.some(pos => pos.x === position.x && pos.y === position.y);
        } while (isInvalid);
        
        return position;
      }

      updateScore() {
        this.scoreElement.textContent = this.score;
        this.overlayScore.textContent = this.score;
      }

      move() {
        if (this.isPaused || this.isGameOver) return;

        const head = { ...this.snake[0] };
        head.x += this.velocity.x;
        head.y += this.velocity.y;

        // –ü–æ—Ä—Ç–∞–ª —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—ã
        if (head.x < 0) head.x = this.tileCount - 1;
        if (head.x >= this.tileCount) head.x = 0;
        if (head.y < 0) head.y = this.tileCount - 1;
        if (head.y >= this.tileCount) head.y = 0;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —Å–æ–±–æ–π
        if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
          this.gameOver();
          return;
        }

        this.snake.unshift(head);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –µ–¥—É
        if (head.x === this.food.x && head.y === this.food.y) {
          this.score++;
          this.updateScore();
          this.generateFood();
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 5 –æ—á–∫–æ–≤
          if (this.score % 5 === 0 && this.speed > 80) {
            this.speed -= 10;
          }
        } 
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —è–¥
        else if (head.x === this.poison.x && head.y === this.poison.y) {
          this.score = Math.max(0, this.score - 1);
          this.updateScore();
          
          // –£–∫–æ—Ä–∞—á–∏–≤–∞–µ–º –∑–º–µ–π–∫—É –Ω–∞ 2 —Å–µ–≥–º–µ–Ω—Ç–∞
          for (let i = 0; i < 2; i++) {
            if (this.snake.length > 2) {
              this.snake.pop();
            }
          }
          
          this.generatePoison();
        } 
        // –û–±—ã—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
        else {
          this.snake.pop();
        }
      }

      render() {
        // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
        this.ctx.fillStyle = '#020617';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∫–∏
        this.ctx.strokeStyle = '#1e293b';
        this.ctx.lineWidth = 1;
        
        for (let i = 0; i <= this.tileCount; i++) {
          this.ctx.beginPath();
          this.ctx.moveTo(i * this.gridSize + 0.5, 0);
          this.ctx.lineTo(i * this.gridSize + 0.5, this.canvas.height);
          this.ctx.stroke();
          
          this.ctx.beginPath();
          this.ctx.moveTo(0, i * this.gridSize + 0.5);
          this.ctx.lineTo(this.canvas.width, i * this.gridSize + 0.5);
          this.ctx.stroke();
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –µ–¥—ã (–∫–æ—Ñ–µ)
        this.ctx.font = `${this.gridSize * 0.9}px sans-serif`;
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';
        this.ctx.fillStyle = '#f97316';
        this.ctx.fillText('‚òï', 
          this.food.x * this.gridSize + this.gridSize / 2,
          this.food.y * this.gridSize + this.gridSize / 2
        );

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ —è–¥–∞ (—Å—Ç–æ–ø-–∑–Ω–∞–∫)
        this.ctx.fillStyle = '#ef4444';
        this.ctx.fillText('üõë',
          this.poison.x * this.gridSize + this.gridSize / 2,
          this.poison.y * this.gridSize + this.gridSize / 2
        );

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∑–º–µ–π–∫–∏
        this.snake.forEach((segment, index) => {
          if (index === 0) {
            // –ì–æ–ª–æ–≤–∞
            this.ctx.fillStyle = '#22c55e';
            this.ctx.beginPath();
            this.ctx.roundRect(
              segment.x * this.gridSize + 2,
              segment.y * this.gridSize + 2,
              this.gridSize - 4,
              this.gridSize - 4,
              4
            );
            this.ctx.fill();
            
            // –ì–ª–∞–∑–∞
            this.ctx.fillStyle = '#ffffff';
            const eyeSize = this.gridSize / 8;
            this.ctx.beginPath();
            this.ctx.arc(
              segment.x * this.gridSize + this.gridSize * 0.3,
              segment.y * this.gridSize + this.gridSize * 0.3,
              eyeSize,
              0,
              Math.PI * 2
            );
            this.ctx.arc(
              segment.x * this.gridSize + this.gridSize * 0.7,
              segment.y * this.gridSize + this.gridSize * 0.3,
              eyeSize,
              0,
              Math.PI * 2
            );
            this.ctx.fill();
          } else {
            // –¢–µ–ª–æ
            this.ctx.fillStyle = index % 2 === 0 ? '#16a34a' : '#15803d';
            this.ctx.beginPath();
            this.ctx.roundRect(
              segment.x * this.gridSize + 2,
              segment.y * this.gridSize + 2,
              this.gridSize - 4,
              this.gridSize - 4,
              3
            );
            this.ctx.fill();
          }
        });
      }

      gameLoop(timestamp) {
        if (!this.lastTimestamp) this.lastTimestamp = timestamp;
        
        const delta = timestamp - this.lastTimestamp;
        
        if (delta > this.speed) {
          this.move();
          this.render();
          this.lastTimestamp = timestamp;
        }
        
        this.animationId = requestAnimationFrame((ts) => this.gameLoop(ts));
      }

      startGameLoop() {
        this.animationId = requestAnimationFrame((ts) => this.gameLoop(ts));
      }

      stopGameLoop() {
        if (this.animationId) {
          cancelAnimationFrame(this.animationId);
          this.animationId = null;
        }
      }

      gameOver() {
        this.isGameOver = true;
        this.showOverlay('–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', 'restart');
      }

      togglePause() {
        this.isPaused = !this.isPaused;
        
        if (this.isPaused) {
          this.showOverlay('–ü–ê–£–ó–ê', 'resume');
        } else {
          this.hideOverlay();
        }
      }

      showOverlay(title, action = 'resume') {
        this.overlayTitle.textContent = title;
        this.overlayScore.textContent = this.score;
        
        const resumeBtn = document.getElementById('resumeButton');
        resumeBtn.textContent = action === 'restart' ? '–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê' : '–ü–†–û–î–û–õ–ñ–ò–¢–¨';
        resumeBtn.onclick = action === 'restart' ? () => this.restartGame() : () => this.togglePause();
        
        this.overlay.classList.add('active');
      }

      hideOverlay() {
        this.overlay.classList.remove('active');
      }

      restartGame() {
        this.stopGameLoop();
        this.resetGame();
        this.startGameLoop();
      }

      setupControls() {
        document.addEventListener('keydown', (e) => {
          e.preventDefault();
          
          switch (e.key.toLowerCase()) {
            case 'arrowup':
            case 'w':
              if (this.velocity.y === 0) this.velocity = { x: 0, y: -1 };
              break;
            case 'arrowdown':
            case 's':
              if (this.velocity.y === 0) this.velocity = { x: 0, y: 1 };
              break;
            case 'arrowleft':
            case 'a':
              if (this.velocity.x === 0) this.velocity = { x: -1, y: 0 };
              break;
            case 'arrowright':
            case 'd':
              if (this.velocity.x === 0) this.velocity = { x: 1, y: 0 };
              break;
            case ' ':
            case 'p':
              this.togglePause();
              break;
            case 'r':
              this.restartGame();
              break;
          }
        });
      }

      setupMobileControls() {
        let touchStartX = 0;
        let touchStartY = 0;
        const minSwipeDistance = 20;

        this.canvas.addEventListener('touchstart', (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          touchStartX = touch.clientX;
          touchStartY = touch.clientY;
        }, { passive: false });

        this.canvas.addEventListener('touchend', (e) => {
          e.preventDefault();
          const touch = e.changedTouches[0];
          const dx = touch.clientX - touchStartX;
          const dy = touch.clientY - touchStartY;

          if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > minSwipeDistance) {
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
            if (dx > 0 && this.velocity.x === 0) this.velocity = { x: 1, y: 0 };
            else if (dx < 0 && this.velocity.x === 0) this.velocity = { x: -1, y: 0 };
          } else if (Math.abs(dy) > minSwipeDistance) {
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
            if (dy > 0 && this.velocity.y === 0) this.velocity = { x: 0, y: 1 };
            else if (dy < 0 && this.velocity.y === 0) this.velocity = { x: 0, y: -1 };
          } else {
            // –ü—Ä–æ—Å—Ç–æ–µ –∫–∞—Å–∞–Ω–∏–µ - –ø–∞—É–∑–∞
            this.togglePause();
          }
        }, { passive: false });

        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        document.querySelectorAll('.mobile-controls button').forEach(button => {
          button.addEventListener('click', () => {
            const direction = button.classList[0];
            switch (direction) {
              case 'up':
                if (this.velocity.y === 0) this.velocity = { x: 0, y: -1 };
                break;
              case 'down':
                if (this.velocity.y === 0) this.velocity = { x: 0, y: 1 };
                break;
              case 'left':
                if (this.velocity.x === 0) this.velocity = { x: -1, y: 0 };
                break;
              case 'right':
                if (this.velocity.x === 0) this.velocity = { x: 1, y: 0 };
                break;
            }
          });
        });
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
      new SnakeGame();
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É roundRect –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
        if (w < 2 * r) r = w / 2;
        if (h < 2 * r) r = h / 2;
        this.beginPath();
        this.moveTo(x + r, y);
        this.arcTo(x + w, y, x + w, y + h, r);
        this.arcTo(x + w, y + h, x, y + h, r);
        this.arcTo(x, y + h, x, y, r);
        this.arcTo(x, y, x + w, y, r);
        this.closePath();
        return this;
      };
    }
  </script>
</body>
</html>
