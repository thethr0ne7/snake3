<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ú–∏–Ω–∏-–∏–≥—Ä–∞: –ó–º–µ–π–∫–∞ (–∫–æ—Ñ–µ + —Å—Ç–æ–ø-–∑–Ω–∞–∫)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #020617;
      color: #e5e7eb;
    }

    .game-wrapper {
      background: #020617;
      border-radius: 18px;
      padding: 16px 18px 16px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      border: 1px solid #1f2937;
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 420px;
      margin: 12px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
      gap: 8px;
    }

    .logo-title {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 0;
    }

    .logo-title img {
      height: 32px;
      width: auto;
      border-radius: 8px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .title {
      font-weight: 600;
      letter-spacing: 0.04em;
      font-size: 12px;
      text-transform: uppercase;
      color: #9ca3af;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .score {
      font-size: 14px;
      color: #e5e7eb;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .score span {
      font-weight: 600;
      color: #22c55e;
    }

    #game {
      border-radius: 12px;
      border: 1px solid #111827;
      background: #020617;
      image-rendering: pixelated;
      width: 100%;
      height: auto;
      display: block;
      touch-action: none;
    }

    .status {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
      line-height: 1.4;
    }

    .status span {
      color: #f97316;
      font-weight: 500;
    }

    .legend {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }

    .legend span {
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="header">
      <div class="logo-title">
        <img src="assets/–†–µ—Å—É—Ä—Å 6–ö–ê–ü–õ–ò–°–¢–ê–ö–ê–ù–ê.png" alt="–õ–æ–≥–æ—Ç–∏–ø" />
        <div class="title">–ª—é–±–∏–º–∞—è –∑–º–µ–π–∫–∞ </div>
      </div>
      <div class="score">–°—á—ë—Ç: <span id="score">0</span></div>
    </div>

    <canvas id="game" width="400" height="400"></canvas>

    <div class="status" id="status">
      –ü–ö: —Å—Ç—Ä–µ–ª–∫–∏ ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, <span>–ø—Ä–æ–±–µ–ª</span> ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫.  
      –¢–µ–ª–µ—Ñ–æ–Ω: —Å–≤–∞–π–ø—ã –ø–æ –ø–æ–ª—é.
    </div>

    <div class="legend">
      ‚òï ‚Äî –µ–¥–∞ (—Ä–æ—Å—Ç +1)<br/>
      üõë ‚Äî —è–¥ (‚àí –¥–ª–∏–Ω–∞, ‚àí1 –æ—á–∫–æ)<br/>
      –ü–æ—Ä—Ç–∞–ª—ã ‚Äî –≤—ã—Ö–æ–¥–∏—à—å –∏ –ø–æ—è–≤–ª—è–µ—à—å—Å—è —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const tileCount = 20;
    const gridSize = canvas.width / tileCount;

    let snake;
    let velocity;
    let food;
    let poison;
    let score;
    let gameOver;

    let tickInterval = 170; 
    let timerId = null;

    const MIN_LENGTH = 2;
    const POISON_SHRINK = 2;

    function setStatus(text) {
      document.getElementById("status").innerHTML = text;
    }

    function resetGame() {
      snake = [
        { x: 10, y: 10 },
        { x: 9, y: 10 },
        { x: 8, y: 10 },
      ];
      velocity = { x: 1, y: 0 };
      score = 0;
      gameOver = false;
      document.getElementById("score").textContent = score;

      food = randomFree();
      poison = randomFree([food]);

      setStatus("–ü–ö: —Å—Ç—Ä–µ–ª–∫–∏, –ø—Ä–æ–±–µ–ª. –¢–µ–ª–µ—Ñ–æ–Ω: —Å–≤–∞–π–ø—ã.");

      if (timerId) clearInterval(timerId);
      timerId = setInterval(update, tickInterval);
      draw();
    }

    function randomFree(block = []) {
      while (true) {
        const x = Math.floor(Math.random() * tileCount);
        const y = Math.floor(Math.random() * tileCount);

        const onSnake = snake.some((s) => s.x === x && s.y === y);
        const onBlock = block.some((b) => b.x === x && b.y === y);

        if (!onSnake && !onBlock) return { x, y };
      }
    }

    function update() {
      if (gameOver) return;

      let nx = snake[0].x + velocity.x;
      let ny = snake[0].y + velocity.y;

      if (nx < 0) nx = tileCount - 1;
      if (nx >= tileCount) nx = 0;
      if (ny < 0) ny = tileCount - 1;
      if (ny >= tileCount) ny = 0;

      const head = { x: nx, y: ny };

      if (snake.some((s) => s.x === head.x && s.y === head.y)) {
        end();
        return;
      }

      snake.unshift(head);

      const hitFood = head.x === food.x && head.y === food.y;
      const hitPoison = head.x === poison.x && head.y === poison.y;

      if (hitFood) {
        score++;
        document.getElementById("score").textContent = score;
        food = randomFree([poison]);
      } else if (hitPoison) {
        score = Math.max(0, score - 1);
        document.getElementById("score").textContent = score;

        for (let i = 0; i < POISON_SHRINK; i++) {
          if (snake.length > MIN_LENGTH) snake.pop();
        }

        poison = randomFree([food]);
      } else {
        snake.pop();
      }

      draw();
    }

    function draw() {
      ctx.fillStyle = "#020617";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = "#0f172a";
      for (let i = 0; i <= tileCount; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize + 0.5, 0);
        ctx.lineTo(i * gridSize + 0.5, canvas.height);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0, i * gridSize + 0.5);
        ctx.lineTo(canvas.width, i * gridSize + 0.5);
        ctx.stroke();
      }

      // ‚òï –∫–æ—Ñ–µ ‚Äî –µ–¥–∞
      ctx.font = `${gridSize}px sans-serif`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("‚òï", food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2);

      // üõë —Å—Ç–æ–ø-–∑–Ω–∞–∫ ‚Äî —è–¥
      ctx.fillText("üõë", poison.x * gridSize + gridSize/2, poison.y * gridSize + gridSize/2);

      snake.forEach((s, i) => {
        ctx.fillStyle = i === 0 ? "#22c55e" : "#16a34a";
        ctx.fillRect(
          s.x * gridSize + 2,
          s.y * gridSize + 2,
          gridSize - 4,
          gridSize - 4
        );
      });
    }

    function end() {
      gameOver = true;
      setStatus(
        "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –°—á—ë—Ç: <span>" +
          score +
          "</span>. –ü–ö: –ø—Ä–æ–±–µ–ª. –¢–µ–ª–µ—Ñ–æ–Ω: –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å."
      );
    }

    document.addEventListener("keydown", (e) => {
      if (gameOver && e.code === "Space") {
        resetGame();
        return;
      }

      switch (e.key) {
        case "ArrowUp": if (velocity.y === 0) velocity = { x: 0, y: -1 }; break;
        case "ArrowDown": if (velocity.y === 0) velocity = { x: 0, y: 1 }; break;
        case "ArrowLeft": if (velocity.x === 0) velocity = { x: -1, y: 0 }; break;
        case "ArrowRight": if (velocity.x === 0) velocity = { x: 1, y: 0 }; break;
      }
    });

    let sx = null, sy = null;

    canvas.addEventListener("touchstart", (e) => {
      const t = e.touches[0];
      sx = t.clientX;
      sy = t.clientY;
    }, { passive: false });

    canvas.addEventListener("touchmove", (e) => { e.preventDefault(); }, { passive: false });

    canvas.addEventListener("touchend", (e) => {
      if (sx === null || sy === null) return;

      const t = e.changedTouches[0];
      const dx = t.clientX - sx;
      const dy = t.clientY - sy;

      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && velocity.x === 0) velocity = { x: 1, y: 0 };
        if (dx < 0 && velocity.x === 0) velocity = { x: -1, y: 0 };
      } else {
        if (dy > 0 && velocity.y === 0) velocity = { x: 0, y: 1 };
        if (dy < 0 && velocity.y === 0) velocity = { x: 0, y: -1 };
      }

      sx = sy = null;
    }, { passive: false });

    resetGame();
  </script>
</body>
</html>

